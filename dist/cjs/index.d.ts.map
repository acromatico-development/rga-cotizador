{"mappings":"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","sources":["src/src/index.ts","src/index.ts"],"sourcesContent":[null,"// import axios from \"axios\";\n\nexport enum EstadoEnGarantia {\n  \"Aguascalientes\" = 500,\n  \"Baja California\" = 3350,\n  \"Baja California Sur\" = 3350,\n  \"Campeche\" = 575,\n  \"Chiapas\" = 500,\n  \"Chihuahua\" = 500,\n  \"Ciudad de México\" = 500,\n  \"Coahuila de Zaragoza\" = 500,\n  \"Colima\" = 500,\n  \"Durango\" = 575,\n  \"Guanajuato\" = 500,\n  \"Guerrero\" = 2050,\n  \"Hidalgo\" = 1050,\n  \"Jalisco\" = 690,\n  \"México\" = 500,\n  \"Michoacán de Ocampo\" = 1950,\n  \"Morelos\" = 500,\n  \"Nayarit\" = 500,\n  \"Nuevo León\" = 575,\n  \"Oaxaca\" = 575,\n  \"Puebla\" = 1800,\n  \"Querétaro\" = 500,\n  \"Quintana Roo\" = 1200,\n  \"San Luis Potosí\" = 2200,\n  \"Sinaloa\" = 3200,\n  \"Sonora\" = 3000,\n  \"Tabasco\" = 575,\n  \"Tamaulipas\" = 575,\n  \"Tlaxcala\" = 1450,\n  \"Veracruz de Ignacio de la Llave\" = 3200,\n  \"Yucatán\" = 3350,\n  \"Zacatecas\" = 575,\n}\n\nexport enum EstadoFirma {\n  \"Aguascalientes\" = 5000,\n  \"Baja California\" = 5000,\n  \"Baja California Sur\" = 5000,\n  \"Campeche\" = 5000,\n  \"Chiapas\" = 5000,\n  \"Chihuahua\" = 5000,\n  \"Ciudad de México\" = 300,\n  \"Coahuila de Zaragoza\" = 5000,\n  \"Colima\" = 5000,\n  \"Durango\" = 5000,\n  \"Guanajuato\" = 5000,\n  \"Guerrero\" = 5000,\n  \"Hidalgo\" = 5000,\n  \"Jalisco\" = 5000,\n  \"México\" = 350,\n  \"Michoacán de Ocampo\" = 5000,\n  \"Morelos\" = 5000,\n  \"Nayarit\" = 5000,\n  \"Nuevo León\" = 5000,\n  \"Oaxaca\" = 5000,\n  \"Puebla\" = 500,\n  \"Querétaro\" = 5000,\n  \"Quintana Roo\" = 5000,\n  \"San Luis Potosí\" = 5000,\n  \"Sinaloa\" = 5000,\n  \"Sonora\" = 5000,\n  \"Tabasco\" = 5000,\n  \"Tamaulipas\" = 5000,\n  \"Tlaxcala\" = 5000,\n  \"Veracruz de Ignacio de la Llave\" = 5000,\n  \"Yucatán\" = 5000,\n  \"Zacatecas\" = 5000,\n}\n\nexport enum NivelCobertura {\n  lite = \"Lite\",\n  alpha = \"Alpha\",\n  alphaPlus = \"Alpha Plus\",\n}\n\nexport enum Coberturas {\n  investigacionRpp = \"Investigacion RPP\",\n  seguro = \"Seguro\",\n  firmaDeContrato = \"Firma de Contrat\",\n  investigacionRG = \"Investigación RG\",\n  gestionExtrajudicial = \"Gestion Extrajudicial\",\n  recuperacionInmueble = \"Recuperacion de Inmueble\",\n  recuperacionDeAdeudos = \"Recuperacion de Adeudos\",\n}\n\ntype Nivel = {\n  nombre: NivelCobertura;\n  coberturas: Coberturas[];\n};\n\ntype CpData = {\n  ciudad: string;\n  estado: string;\n  municipio: string;\n  colonias: [string];\n  codigoPostal: string;\n};\n\n// TO DO: Bu\nconst permitedCities = [\n  \"Cancún\",\n  \"Ciudad de México\",\n  \"Cuernavaca\",\n  \"Guadalajara\",\n  \"Zapopan\",\n  \"Tonalá\",\n  \"Tlajomulco de Zúñiga\",\n  \"El Salto\",\n  \"Ixtlahuacán de los Membrillos\",\n  \"Juanacatlán\",\n  \"Zapotlanejo\",\n  \"Acatlán de Juárez\",\n  \"Tlaquepaque\",\n  \"Mérida\",\n  \"Monterrey\",\n  \"San Nicolás de los Garza\",\n  \"Ciudad Apodaca\",\n  \"García\",\n  \"Ciudad General Escobedo\",\n  \"Guadalupe\",\n  \"Ciudad Santa Catarina\",\n  \"San Pedro Garza García\",\n  \"Pachuca de Soto\",\n  \"Heroica Puebla de Zaragoza\",\n  \"Santiago de Querétaro\",\n];\n\nexport class Cotizador {\n  //Variables\n  renta: number;\n  cp: string;\n  estadoGarantia: EstadoEnGarantia;\n  estadoFirma: EstadoFirma;\n  nivelCobertura: Nivel | undefined;\n  resolved: Promise<void>;\n  private _perfilRiesgoIncumplimiento: number;\n  private _investigacionRg: number;\n  private _perfilRiesgoJuicioRecuperacion: number;\n  private _perfilRiesgoJuicioAdeudos: number;\n\n  //Constantes\n  private _factorInvestigacion: number;\n  private _factorSeguro: number;\n  private _factorFirma: number;\n  private _factorSolvencia: number;\n  private _factorIncumplimiento: number;\n  private _factorRecuperacion: number;\n  private _factorAdeudos: number;\n  private _niveles: Nivel[];\n\n  //Costos\n  costoInvestigacion: number;\n  costoSeguro: number;\n  costoFirma: number;\n  costoInvestigacionRg: number;\n  costoIncumplimiento: number;\n  costoRecuperacion: number;\n  costoAdeudos: number;\n\n  //Cotizacion\n  private _costoDeVentas: number;\n  private _utilidad: number;\n  precioDeVentas: number;\n  precioDeVentasMasIVA: number;\n  private _comisionInmobiliaria: number;\n\n  constructor(\n    renta: number,\n    cp: string,\n    estadoFirma: EstadoFirma,\n    nivelCobertura: NivelCobertura\n  ) {\n    this.renta = renta;\n\n    this.resolved = new Promise<void>(async (resolve) => {\n      const cpData: CpData = await this.getCpData(cp);\n\n      console.log(\"cp\", cpData);\n\n      const permitido = permitedCities.find((city) => city === cpData.ciudad);\n\n      if (!permitido) {\n        const edomex = cpData.estado === \"México\";\n        if (!edomex) {\n          console.log(\"No se encontró la ciudad\");\n          throw new Error(\"No se encontró la ciudad\");\n        }\n      }\n\n      this.estadoGarantia = EstadoEnGarantia[cpData.estado]\n        ? EstadoEnGarantia[cpData.estado]\n        : EstadoEnGarantia[\"Ciudad de México\"];\n\n      this.estadoFirma = estadoFirma\n        ? estadoFirma\n        : EstadoFirma[\"Ciudad de México\"];\n\n      //TO DO: traer variables de fuente externa\n      this._investigacionRg = 21;\n      this._perfilRiesgoIncumplimiento = 0.2;\n      this._perfilRiesgoJuicioRecuperacion = 0.025;\n      this._perfilRiesgoJuicioAdeudos = 0.025;\n\n      //TO DO: traer constantes de fuente externa\n      this._factorInvestigacion = 1;\n      this._factorSeguro = 0.1308;\n      this._factorFirma = 1;\n      this._factorSolvencia = 1;\n      this._factorIncumplimiento = 180;\n      this._factorRecuperacion = 3718.88;\n      this._factorAdeudos = 14875.51;\n\n      //TO DO: traer niveles de fuente externa\n      this._niveles = [\n        {\n          nombre: NivelCobertura.alpha,\n          coberturas: [\n            Coberturas.investigacionRpp,\n            Coberturas.firmaDeContrato,\n            Coberturas.investigacionRG,\n            Coberturas.gestionExtrajudicial,\n            Coberturas.recuperacionInmueble,\n            Coberturas.recuperacionDeAdeudos,\n          ],\n        },\n        {\n          nombre: NivelCobertura.alphaPlus,\n          coberturas: [\n            Coberturas.investigacionRpp,\n            Coberturas.firmaDeContrato,\n            Coberturas.investigacionRG,\n            Coberturas.gestionExtrajudicial,\n            Coberturas.recuperacionInmueble,\n            Coberturas.recuperacionDeAdeudos,\n            Coberturas.seguro,\n          ],\n        },\n        {\n          nombre: NivelCobertura.lite,\n          coberturas: [\n            Coberturas.investigacionRG,\n            Coberturas.gestionExtrajudicial,\n            Coberturas.recuperacionInmueble,\n          ],\n        },\n      ];\n\n      this.nivelCobertura = this._niveles.find(\n        (niv) => niv.nombre === nivelCobertura\n      )\n        ? this._niveles.find((niv) => niv.nombre === nivelCobertura)\n        : this._niveles[0];\n\n      // axios(\"https://www.lycklig.com.mx/products/platos-rosa-con-dorado.json\")\n      //   .then((data) => console.log(data.data))\n      //   .catch((err) => console.log(err));\n\n      //setear a 0 costos\n      this.costoInvestigacion = 0;\n      this.costoSeguro = 0;\n      this.costoFirma = 0;\n      this.costoInvestigacionRg = 0;\n      this.costoIncumplimiento = 0;\n      this.costoRecuperacion = 0;\n      this.costoAdeudos = 0;\n\n      //setear a 0 cotización\n      this._costoDeVentas = 0;\n      this._utilidad = 0;\n      this.precioDeVentas = 0;\n      this.precioDeVentasMasIVA = 0;\n      this._comisionInmobiliaria = 0;\n\n      this.calcularCostos();\n      this.cotizar();\n\n      console.log(\"Terminando\");\n      resolve();\n    });\n  }\n\n  private async getCpData(cp: string) {\n    const ciudad = await fetch(\n      `https://acromatico-cp.uc.r.appspot.com/api/cp/${cp}`,\n      {\n        headers: {\n          \"X-Acromatico-JWT-Token\":\n            \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2wiOiJBZG1pbiIsImlkIjoiMTIzNDU2In0.lU5p4VREH8qVitzPaNmteGGmtpJA8PwiSNrHkhhJC1o\",\n        },\n      }\n    );\n\n    const ciudadData = await ciudad.json();\n\n    return ciudadData;\n  }\n\n  private calculoUtilidad(renta: number): number {\n    let resultado: number;\n\n    if (renta <= 350 / 0.05) {\n      resultado = 0.0428826023 * renta + 2412;\n    } else if (renta <= 8205.162) {\n      resultado = -0.0128826023 * renta + 2762;\n    } else if (renta <= 90000) {\n      resultado = 0.3295 * renta;\n    } else {\n      resultado = 0.23308 * renta + 8684;\n    }\n\n    if (renta <= 350 / 0.05) {\n      resultado += 350;\n    } else if (renta <= 2000 / 0.05) {\n      resultado += 0.05 * renta;\n    } else {\n      resultado += 2000;\n    }\n\n    resultado = resultado - 821.86;\n\n    return resultado;\n  }\n\n  calcularCostos() {\n    this.costoInvestigacion = this.nivelCobertura?.coberturas.find(\n      (cober) => cober === Coberturas.investigacionRpp\n    )\n      ? this._factorInvestigacion * this.estadoGarantia\n      : 0;\n    this.costoSeguro = this.nivelCobertura?.coberturas.find(\n      (cober) => cober === Coberturas.seguro\n    )\n      ? this._factorSeguro * this.renta\n      : 0;\n    this.costoFirma = this.nivelCobertura?.coberturas.find(\n      (cober) => cober === Coberturas.firmaDeContrato\n    )\n      ? this._factorFirma * this.estadoFirma\n      : 0;\n    this.costoInvestigacionRg = this.nivelCobertura?.coberturas.find(\n      (cober) => cober === Coberturas.investigacionRG\n    )\n      ? this._factorSolvencia * this._investigacionRg\n      : 0;\n    this.costoIncumplimiento = this.nivelCobertura?.coberturas.find(\n      (cober) => cober === Coberturas.gestionExtrajudicial\n    )\n      ? this._factorIncumplimiento * this._perfilRiesgoIncumplimiento\n      : 0;\n    this.costoRecuperacion = this.nivelCobertura?.coberturas.find(\n      (cober) => cober === Coberturas.recuperacionInmueble\n    )\n      ? this._factorRecuperacion * this._perfilRiesgoJuicioRecuperacion\n      : 0;\n    this.costoAdeudos = this.nivelCobertura?.coberturas.find(\n      (cober) => cober === Coberturas.recuperacionDeAdeudos\n    )\n      ? this._factorAdeudos * this._perfilRiesgoJuicioAdeudos\n      : 0;\n  }\n\n  cotizar(): number {\n    this._costoDeVentas =\n      this.costoInvestigacion +\n      this.costoSeguro +\n      this.costoFirma +\n      this.costoInvestigacionRg +\n      this.costoIncumplimiento +\n      this.costoRecuperacion +\n      this.costoAdeudos;\n\n    this._utilidad = this.calculoUtilidad(this.renta);\n\n    let precioVentasTemp = this._utilidad + this._costoDeVentas;\n\n    // Minimo de precio de venta ed de $3500 ya con IVA\n    if (precioVentasTemp * 1.16 < 3500) {\n      precioVentasTemp = 3500 / 1.16;\n    }\n\n    this.precioDeVentas = Math.floor(precioVentasTemp * 100) / 100;\n    this.precioDeVentasMasIVA =\n      Math.floor(this.precioDeVentas * 1.16 * 100) / 100;\n    this.precioDeVentasMasIVA = Math.ceil(this.precioDeVentasMasIVA / 10) * 10;\n    this.precioDeVentas =\n      Math.floor((this.precioDeVentasMasIVA / 1.16) * 100) / 100;\n    this._comisionInmobiliaria =\n      Math.floor(this.precioDeVentasMasIVA * 0.1 * 100) / 100;\n\n    return this.precioDeVentasMasIVA;\n  }\n\n  cambiarRenta(renta: number): number {\n    this.renta = renta;\n\n    this.calcularCostos();\n\n    return this.cotizar();\n  }\n\n  cambiarEstadoGarantia(estado: EstadoEnGarantia): number {\n    this.estadoGarantia = estado;\n\n    this.calcularCostos();\n\n    return this.cotizar();\n  }\n\n  cambiarEstadoFirma(estado: EstadoFirma): number {\n    this.estadoFirma = estado;\n\n    this.calcularCostos();\n\n    return this.cotizar();\n  }\n\n  cambiarNivel(nivel: NivelCobertura): number {\n    this.nivelCobertura = this._niveles.find((niv) => niv.nombre === nivel)\n      ? this._niveles.find((niv) => niv.nombre === nivel)\n      : this._niveles[0];\n\n    this.calcularCostos();\n\n    return this.cotizar();\n  }\n}\n"],"names":[],"version":3,"file":"index.d.ts.map"}